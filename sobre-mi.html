<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sobre Mí | iLupo Warehouse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="/favicon/site.webmanifest" />
</head>
<body class="detail-page-body">
    <a href="index.html" class="back-link">&larr; Volver a todos los proyectos</a>
    <main id="about-content-container" class="project-detail-container"></main>
    <footer>
        <p>© 2025 iLupo Warehouse | Administrado por alberto64674yt</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            marked.setOptions({ gfm: true, breaks: true });
            
            fetch('info.json')
                .then(response => response.json())
                .then(data => {
                    renderAboutContent(data.contenido);
                })
                .catch(error => {
                    console.error('Error al cargar info.json:', error);
                    renderAboutContent('# Error\n\nNo se pudo cargar el contenido de la página.');
                });
        });

        // --- INICIO: NUEVAS FUNCIONES PARA COMPONENTES ---

        // Función para inicializar la interactividad de las pestañas (Tabs)
        function initializeTabs() {
            const tabContainers = document.querySelectorAll('.tabs-container');
            tabContainers.forEach(container => {
                const navButtons = container.querySelectorAll('.tab-button');
                const contentPanels = container.querySelectorAll('.tab-content');

                navButtons.forEach((button, index) => {
                    button.addEventListener('click', () => {
                        navButtons.forEach(btn => btn.classList.remove('active'));
                        contentPanels.forEach(panel => panel.classList.remove('active'));
                        button.classList.add('active');
                        contentPanels[index].classList.add('active');
                    });
                });
            });
        }

        // "Traductor" de Shortcodes a HTML
        function parseCustomShortcodes(content) {
            let processedContent = content || '';

            processedContent = processedContent.replace(/\[spoiler:([^\]]+)\]([\s\S]*?)\[\/spoiler\]/g, (match, title, innerContent) => {
                return `<details><summary>${title}</summary>${marked.parse(innerContent)}</details>`;
            });

            processedContent = processedContent.replace(/\[(nota|aviso|info)\]([\s\S]*?)\[\/\1\]/g, (match, type, innerContent) => {
                return `<div class="alert alert-${type}">${marked.parse(innerContent)}</div>`;
            });

            processedContent = processedContent.replace(/\[tabs\]([\s\S]*?)\[\/tabs\]/g, (match, innerContent) => {
                const navLinks = [];
                const tabContents = [];
                const tabRegex = /\[tab:([^\]]+)\]([\s\S]*?)(?=\[tab:|$)/g;
                let tabMatch;
                
                while ((tabMatch = tabRegex.exec(innerContent)) !== null) {
                    navLinks.push(tabMatch[1]);
                    tabContents.push(marked.parse(tabMatch[2]));
                }

                if (navLinks.length === 0) return '';

                const navHtml = navLinks.map((title, index) => 
                    `<button class="tab-button ${index === 0 ? 'active' : ''}">${title}</button>`
                ).join('');

                const contentHtml = tabContents.map((content, index) =>
                    `<div class="tab-content ${index === 0 ? 'active' : ''}">${content}</div>`
                ).join('');

                return `<div class="tabs-container"><div class="tabs-nav">${navHtml}</div>${contentHtml}</div>`;
            });
            
            return processedContent;
        }

        // --- FIN: NUEVAS FUNCIONES PARA COMPONENTES ---

        function renderAboutContent(markdownContent) {
            const container = document.getElementById('about-content-container');
            if (markdownContent) {
                let processedContent = parseCustomShortcodes(markdownContent);
                let finalHtml = marked.parse(processedContent);
                
                // --- INICIO: LÓGICA MEJORADA PARA TABLAS ---
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = finalHtml;
                
                // Envolver tablas para hacerlas scrollables
                tempDiv.querySelectorAll('table').forEach(table => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'table-wrapper';
                    table.parentNode.insertBefore(wrapper, table);
                    wrapper.appendChild(table);
                });

                finalHtml = tempDiv.innerHTML;
                // --- FIN: LÓGICA MEJORADA ---

                container.innerHTML = finalHtml;
                initializeTabs();
            }
        }

        window.addEventListener('message', e => {
            if (e.data.type === 'aboutPreviewUpdate') {
                renderAboutContent(e.data.payload);
            }
        });
    </script>
	
	<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').then(registration => {
        console.log('ServiceWorker registrado con éxito:', registration.scope);
      }).catch(error => {
        console.log('Fallo en el registro del ServiceWorker:', error);
      });
    });
  }
</script>

</body>
</html>
