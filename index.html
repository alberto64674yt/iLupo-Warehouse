<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bienvenido a mi almacén digital. Un portfolio con herramientas, utilidades para Windows, mods y proyectos de juegos creados por alberto64674yt.">
	<meta name="keywords" content="iLupo, alberto64674yt, portfolio, utilidades, software, mods, gaming">
	<title>iLupo Warehouse | Portfolio de Proyectos y Utilidades</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
	<link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
	<link rel="shortcut icon" href="/favicon/favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
	<link rel="manifest" href="/favicon/site.webmanifest" />
</head>
<body>
    <header id="main-header" class="no-select">
		<img id="header-logo" draggable="false" src="/favicon/favicon.svg" alt="Logo de iLupo Warehouse" style="display: block; margin: 0 auto 1.5rem auto; width: 128px; height: 128px; -webkit-user-select: none; -ms-user-select: none; user-select: none;">
        <h1>iLupo Warehouse</h1>
        <p class="subtitle" id="subtitle">
            "Con gran fluidez, mi pequeño workflow exhibe hoy la hazaña de zanjar viejos bugs."
        </p>
    </header>

    <div class="filter-controls">
        <a href="sobre-mi.html" class="about-me-button">Sobre Mí</a>
        <div class="top-controls">
            <div class="search-container">
                <input type="text" id="search-box" placeholder="Buscar por nombre...">
            </div>
            <div class="view-switcher">
                <button id="grid-view-btn" class="view-btn active" title="Vista de Rejilla">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,3V11H11V3M9,9H5V5H9M3,13V21H11V13M9,19H5V15H9M13,3V11H21V3M19,9H15V5H19M13,13V21H21V13M19,19H15V15H19Z"/></svg>
                </button>
                <button id="list-view-btn" class="view-btn" title="Vista de Lista">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,4H21V6H3V4M3,11H21V13H3V11M3,18H21V20H3V18Z"/></svg>
                </button>
            </div>
        </div>
        <div id="tag-filter-container" class="tag-filter-container"></div>
    </div>

    <main id="portfolio-grid"></main>
    <div id="pagination-container" class="pagination-container"></div>
    
    <footer>
        <p>© 2025 iLupo Warehouse | Administrado por alberto64674yt</p>
    </footer>

	<audio id="wolf-howl-audio" src="https://files.catbox.moe/a490qy.mp3" preload="auto"></audio>
    
	<div id="easter-egg-overlay" class="easter-egg-overlay">
        <div class="easter-egg-content">
            <div id="video-container" class="video-container-easter-egg"></div>
            <p class="easter-egg-quote">"A veces es mejor dejar ciertas cosas sin descubrir"</p>
            <p class="easter-egg-signature">2025 - alberto64674yt</p>
            <button id="close-easter-egg" class="close-easter-egg-button">&times;</button>
        </div>
    </div>

    <div id="boykisser-overlay" class="bk-overlay">
        <audio id="boykisser-audio" src="https://files.catbox.moe/yqlere.mp3" preload="auto"></audio>
        <img src="https://i.imgur.com/3WbZsMt.png" alt="Boykisser" id="boykisser-char" class="bk-char">
        <div id="boykisser-bubble" class="bk-bubble">
            <p id="boykisser-text"></p>
        </div>
        <button id="boykisser-close" class="bk-close-btn">&times;</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
    <script>
        let allProjects = [];
        let activeTags = new Set();
        let currentPage = 1;
        const projectsPerPage = 9;
        const searchBox = document.getElementById('search-box');
        const grid = document.getElementById('portfolio-grid');
        const paginationContainer = document.getElementById('pagination-container');
        const tagContainer = document.getElementById('tag-filter-container');
		let searchIndex; // Variable para guardar el índice de búsqueda

        marked.setOptions({ gfm: true, breaks: true });

        const cardObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
		
		function buildSearchIndex(proyectos) {
            searchIndex = lunr(function () {
                this.ref('id');
                this.field('titulo', { boost: 10 });
                this.field('resumen', { boost: 5 });
                this.field('contenido_completo');
                this.field('tags');

                proyectos.forEach(function (p) {
                    // CORRECCIÓN DEFINITIVA: Asegurarse de que TODOS los campos son strings
                    // para evitar errores con la librería de búsqueda.
                    const docToAdd = {
                        id: p.id || '',
                        titulo: p.titulo || '',
                        resumen: p.resumen || '',
                        contenido_completo: p.contenido_completo || '',
                        tags: (p.tags || []).join(' ')
                    };
                    this.add(docToAdd);
                }, this);
            });
        }

        function renderCards(proyectos) {
            grid.innerHTML = '';
            if (!proyectos || proyectos.length === 0) {
                grid.innerHTML = '<p class="empty-message">No se han encontrado proyectos que coincidan con todos los filtros.</p>';
                return;
            }
            const paginatedProjects = proyectos.slice().reverse().slice((currentPage - 1) * projectsPerPage, currentPage * projectsPerPage);
            
            paginatedProjects.forEach((proyecto, index) => {
                const card = document.createElement('a');
                card.className = 'card';
                card.href = `proyecto.html?id=${proyecto.id}`;
                card.addEventListener('mousemove', e => {
                    const rect = e.currentTarget.getBoundingClientRect(), x = e.clientX - rect.left, y = e.clientY - rect.top, centerX = rect.width / 2, centerY = rect.height / 2, rotateX = (y - centerY) / 15, rotateY = (centerX - x) / 15;
                    e.currentTarget.querySelector('.card-inner').style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                });
                card.addEventListener('mouseleave', e => { e.currentTarget.querySelector('.card-inner').style.transform = 'rotateX(0) rotateY(0) scale(1)'; });
                card.innerHTML = `<div class="card-inner"><img class="card-hero-image" src="${proyecto.imagen || ''}" alt="${proyecto.titulo}" loading="lazy"><div class="card-content"><h2>${proyecto.titulo}</h2><div class="card-excerpt">${marked.parse(proyecto.resumen || '')}</div><span class="button-imitation">Ver detalles</span></div></div>`;
                grid.appendChild(card);
                
                const isPreview = (window.self !== window.top);
                if (isPreview || index < 3) {
                    // Si estamos en la vista previa O es una de las 3 primeras tarjetas, hazla visible al instante.
                    card.classList.add('is-visible');
                } else {
                    // Para el resto, usa el observer para el efecto de scroll.
                    cardObserver.observe(card);
                }
            });
        }

        function setupPagination(totalProjects) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalProjects / projectsPerPage);
            if (totalPages <= 1) return;
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.innerText = i;
                pageButton.className = 'page-btn';
                if (i === currentPage) pageButton.classList.add('active');
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    filterAndRender();
                    const headerOffset = document.querySelector('header').offsetHeight;
                    window.scrollTo({ top: headerOffset, behavior: 'smooth' });
                });
                paginationContainer.appendChild(pageButton);
            }
        }
        
        let tagTree = {};

        function buildAndRenderTags(proyectos) {
            tagTree = {};
            proyectos.forEach(p => {
                (p.tags || []).forEach(fullTag => {
                    let currentNode = tagTree;
                    fullTag.split(' > ').forEach(part => {
                        if (!currentNode[part]) currentNode[part] = { children: {} };
                        currentNode = currentNode[part].children;
                    });
                });
            });

            function processTree(nodeLevel, pathPrefix = '') {
                Object.keys(nodeLevel).forEach(key => {
                    const currentNode = nodeLevel[key];
                    const currentPath = pathPrefix ? `${pathPrefix} > ${key}` : key;
                    currentNode.path = currentPath;
                    currentNode.count = allProjects.filter(p => (p.tags || []).some(tag => tag.startsWith(currentPath))).length;
                    if (Object.keys(currentNode.children).length > 0) {
                        processTree(currentNode.children, currentPath);
                    }
                });
            }
            processTree(tagTree);
            
            tagContainer.innerHTML = '';
            const allBtnContainer = document.createElement('div');
            allBtnContainer.className = 'tag-item';
            const allBtn = document.createElement('button');
            allBtn.className = 'tag-button active';
            allBtn.innerText = `Todos (${proyectos.length})`;
            allBtn.onclick = () => {
                activeTags.clear();
                document.querySelectorAll('.tag-checkbox').forEach(cb => cb.checked = false);
                updateAllButtonStates();
                filterAndRender();
            };
            allBtnContainer.appendChild(allBtn);
            tagContainer.appendChild(allBtnContainer);

            renderTagTree(tagTree, tagContainer, 0);
        }

        function renderTagTree(tree, container, level) {
            const sortedKeys = Object.keys(tree).sort();

            sortedKeys.forEach(key => {
                const node = tree[key];
                const nodeName = node.path.split(' > ').pop();
                const hasChildren = Object.keys(node.children).length > 0;
                const inputId = `cb-${node.path.replace(/\s|>/g, '-')}`;

                const itemWrapper = document.createElement('div');
                itemWrapper.className = 'tag-item';
                itemWrapper.style.marginLeft = `${level * 20}px`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = inputId;
                checkbox.className = 'tag-checkbox';
                checkbox.checked = activeTags.has(node.path);
                
                const label = document.createElement('label');
                label.className = 'tag-label';
                label.htmlFor = inputId;
                label.innerHTML = `${nodeName} <span class="tag-count">(${node.count})</span>`;

                let arrow = null;
                if (hasChildren) {
                    arrow = document.createElement('span');
                    arrow.className = 'arrow';
                    itemWrapper.appendChild(arrow);
                }

                itemWrapper.appendChild(checkbox);
                itemWrapper.appendChild(label);
                
                container.appendChild(itemWrapper);

                if (hasChildren) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.className = 'tag-children-container';
                    itemWrapper.appendChild(childrenContainer);

                    const toggleFunc = (e) => {
                        e.stopPropagation();
                        itemWrapper.classList.toggle('expanded');
                        childrenContainer.classList.toggle('visible');
                    };

                    label.addEventListener('click', toggleFunc);
                    arrow.addEventListener('click', toggleFunc);
                    
                    renderTagTree(node.children, childrenContainer, level + 1);
                }

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        activeTags.add(node.path);
                    } else {
                        activeTags.delete(node.path);
                    }
                    updateAllButtonStates();
                    filterAndRender();
                });
            });
        }

        function updateAllButtonStates() {
            const hasActiveTags = activeTags.size > 0;
            document.querySelector('.tag-button').classList.toggle('active', !hasActiveTags);
        }

        function filterAndRender() {
            const searchTerm = searchBox.value.toLowerCase().trim();
            let projectsToShow = allProjects; // Por defecto, mostramos todo.

            // Si hay un término de búsqueda, filtramos los resultados.
            if (searchTerm) {
                // Usamos el índice de Lunr.js si existe.
                if (searchIndex) {
                    const searchResults = searchIndex.search(searchTerm + '*');
                    // Mapeamos los IDs de los resultados a los objetos de proyecto completos.
                    projectsToShow = searchResults.map(result => {
                        return allProjects.find(p => p.id === result.ref);
                    });
                } else {
                    // Fallback por si el índice no se ha creado (nunca debería pasar).
                    projectsToShow = [];
                }
            }

            // Si hay etiquetas activas, filtramos sobre los resultados actuales.
            if (activeTags.size > 0) {
                const activeTagsArr = [...activeTags];
                projectsToShow = projectsToShow.filter(p => {
                    return activeTagsArr.every(activeTagPath => {
                        return (p.tags || []).some(projectTag => projectTag.startsWith(activeTagPath));
                    });
                });
            }

            renderCards(projectsToShow);
            setupPagination(projectsToShow.length);
            updateAllButtonStates();
            // La actualización de la URL la quitamos temporalmente para asegurar estabilidad.
            // updateURLParameters(); 
        }

        fetch('proyectos.json').then(r=>r.json()).then(data=>{
            allProjects=data.items||[];
			buildSearchIndex(allProjects);
            window.proyectos=allProjects;
            buildAndRenderTags(allProjects);
            filterAndRender();
        }).catch(e=>{console.error(e); grid.innerHTML='<p class="empty-message">Error al cargar proyectos.</p>'});

        searchBox.addEventListener('input', () => { currentPage = 1; filterAndRender(); });
        const gridBtn = document.getElementById('grid-view-btn');
        const listBtn = document.getElementById('list-view-btn');
        gridBtn.addEventListener('click', () => { grid.classList.remove('view-list'); gridBtn.classList.add('active'); listBtn.classList.remove('active'); });
        listBtn.addEventListener('click', () => { grid.classList.add('view-list'); listBtn.classList.add('active'); gridBtn.classList.remove('active'); });
        window.addEventListener('message', e => { if (e.data.type === 'previewUpdate') { allProjects = e.data.payload; buildAndRenderTags(allProjects); filterAndRender(); } });
    </script>
    
    <script>
    (function() {
        // --- LÓGICA DE EASTER EGGS, CÓDIGOS SECRETOS Y TERMINAL ---

        // Objeto global para que el terminal pueda llamar a estas funciones
        window.easterEggFunctions = {};

        // --- SISTEMA DE ACCESO SECRETO (PALABRAS CLAVE) ---
        let userInput = "";
        const subtitleElement = document.getElementById('subtitle');
        const secretActions = {
            "admin": () => { window.location.href = 'panel.html'; },
            "boykisser": () => { window.easterEggFunctions.boykisser(); },
            "terminal": () => { cargarTerminal(); } // Puedes cambiar "cmd" por "terminal" si lo prefieres
        };

        if (subtitleElement) {
            const text = subtitleElement.innerText;
            subtitleElement.innerHTML = '';
            text.split('').forEach(char => {
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                subtitleElement.appendChild(charSpan);
            });
            document.addEventListener('click', function(e) {
                if (e.target.parentElement === subtitleElement) {
                    const letter = e.target.textContent.toLowerCase();
                    userInput += letter;
                    let matchFound = false;
                    for (const word in secretActions) {
                        if (word.startsWith(userInput)) {
                            matchFound = true;
                            if (userInput === word) {
                                secretActions[word]();
                                userInput = "";
                                break;
                            }
                        }
                    }
                    if (!matchFound) userInput = "";
                }
            });
        }

        // --- FUNCIÓN DE CARGA DINÁMICA DEL TERMINAL ---
        let terminalCargado = false;
        function cargarTerminal() {
            if (terminalCargado) {
                if (window.Terminal) window.Terminal.toggle();
                return;
            }
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'terminal.css';
            document.head.appendChild(link);
            const script = document.createElement('script');
            script.src = 'terminal.js';
            document.body.appendChild(script);
            script.onload = () => {
                if (window.Terminal && typeof window.Terminal.init === 'function') {
                    window.Terminal.init();
                    terminalCargado = true;
                }
            };
        }

        // --- EASTER EGG #1: TÍTULO 5 CLICS ---
        const titleElement = document.querySelector('#main-header h1');
        const videoOverlay = document.getElementById('easter-egg-overlay');
        const videoContainer = document.getElementById('video-container');
        const closeVideoBtn = document.getElementById('close-easter-egg');
        let clickCount = 0; let timer;

        window.easterEggFunctions.matrix_video = function() { // Expuesto para el terminal
            alert("Has Encontrado algo que no deberías poder estar viéndo, tanto tiempo libre tienes para toquetear toda la pagina y descubrir esto? bueno aqui tienes tu hallazgo:");
            videoContainer.innerHTML = '<iframe src="https://www.youtube.com/embed/bN1shALfJqg?autoplay=1&loop=1&controls=0&playlist=bN1shALfJqg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>';
            videoOverlay.style.display = 'flex';
        };
        const titleText = titleElement.innerText;
        titleElement.innerHTML = '';
        titleText.split('').forEach(char => {
            const charSpan = document.createElement('span');
            charSpan.textContent = char;
            titleElement.appendChild(charSpan);
        });
        document.addEventListener('click', function(e) {
            if (e.target.parentElement === titleElement) {
                clickCount++;
                clearTimeout(timer);
                timer = setTimeout(() => { clickCount = 0; }, 1000);
                if (clickCount === 5) {
                    clickCount = 0;
                    window.easterEggFunctions.matrix_video();
                }
            }
        });
        closeVideoBtn.addEventListener('click', function() {
            videoOverlay.style.display = 'none';
            videoContainer.innerHTML = '';
        });

        // --- EASTER EGG #2: BOYKISSER ---
        const bkOverlay = document.getElementById('boykisser-overlay');
        const bkChar = document.getElementById('boykisser-char');
        const bkAudio = document.getElementById('boykisser-audio');
        const bkTextElement = document.getElementById('boykisser-text');
        const bkCloseBtn = document.getElementById('boykisser-close');
        let typewriterInterval, startTypingTimeout;
        
        window.easterEggFunctions.boykisser = function() { // Expuesto para el terminal
            bkTextElement.innerHTML = '';
            bkCloseBtn.style.display = 'none';
            bkChar.style.transition = 'none';
            bkChar.style.left = '-100%';
            bkAudio.currentTime = 0;
            clearInterval(typewriterInterval);
            clearTimeout(startTypingTimeout);
            bkOverlay.classList.add('visible');
            setTimeout(() => {
                bkChar.style.transition = 'left 2s cubic-bezier(0.25, 1, 0.5, 1)';
                bkChar.style.left = '35%';
                bkAudio.play();
            }, 20);
            const text = "you like kissing boys, don't you?";
            let i = 0;
            startTypingTimeout = setTimeout(() => {
                typewriterInterval = setInterval(() => {
                    if (i < text.length) {
                        bkTextElement.innerHTML += text.charAt(i); i++;
                    } else { clearInterval(typewriterInterval); }
                }, 65);
            }, 1400);
        };

        bkAudio.onended = function() {
            clearInterval(typewriterInterval);
            bkTextElement.innerHTML = "you like kissing boys, don't you?";
            bkCloseBtn.style.display = 'block';
        };
        bkCloseBtn.addEventListener('click', function() {
            bkOverlay.classList.remove('visible');
            clearInterval(typewriterInterval);
            clearTimeout(startTypingTimeout);
            bkAudio.pause();
            bkAudio.currentTime = 0;
        });
        
        // --- EASTER EGG #3: LOGO 5 CLICS (AULLIDO DE LOBO) ---
        const logoElement = document.getElementById('header-logo');
        const wolfHowlAudio = document.getElementById('wolf-howl-audio');

        window.easterEggFunctions.wolf_howl = function() { // Expuesto para el terminal
            if (wolfHowlAudio.paused) {
                wolfHowlAudio.currentTime = 0;
                wolfHowlAudio.play();
            }
        };

        if (logoElement && wolfHowlAudio) {
            let logoClickCount = 0;
            let logoTimer;
            logoElement.addEventListener('click', function() {
                logoClickCount++;
                clearTimeout(logoTimer);
                logoTimer = setTimeout(() => { logoClickCount = 0; }, 1000);
                if (logoClickCount === 5) {
                    window.easterEggFunctions.wolf_howl();
                    logoClickCount = 0;
                }
            });
        }

    })();
</script>
	
	<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').then(registration => {
        console.log('ServiceWorker registrado con éxito:', registration.scope);
      }).catch(error => {
        console.log('Fallo en el registro del ServiceWorker:', error);
      });
    });
  }
</script>

</body>
</html>
