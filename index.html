<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iLupo Warehouse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>iLupo Warehouse</h1>
        <p class="subtitle">
            Un port<span class="secret-letter" data-key="0" onselectstart="return false;">a</span>folio 
            <span class="secret-letter" data-key="1" onselectstart="return false;">d</span>e herra<span class="secret-letter" data-key="2" onselectstart="return false;">m</span>ientas 
            e <span class="secret-letter" data-key="3" onselectstart="return false;">i</span>nve<span class="secret-letter" data-key="4" onselectstart="return false;">n</span>ciones.
        </p>
    </header>

    <div class="filter-controls">
        <div class="top-controls">
            <div class="search-container">
                <input type="text" id="search-box" placeholder="Buscar por nombre...">
            </div>
            <div class="view-switcher">
                <button id="grid-view-btn" class="view-btn active" title="Vista de Rejilla">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,3V11H11V3M9,9H5V5H9M3,13V21H11V13M9,19H5V15H9M13,3V11H21V3M19,9H15V5H19M13,13V21H21V13M19,19H15V15H19Z"/></svg>
                </button>
                <button id="list-view-btn" class="view-btn" title="Vista de Lista">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,4H21V6H3V4M3,11H21V13H3V11M3,18H21V20H3V18Z"/></svg>
                </button>
            </div>
        </div>
        <div id="tag-filter-container" class="tag-filter-container">
            </div>
    </div>

    <main id="portfolio-grid"></main>
    <div id="pagination-container" class="pagination-container"></div>
    
    <footer>
        <p>Â© 2025 iLupo Warehouse | Administrado por alberto64674yt</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        let allProjects = [];
        let activeTags = new Set();
        let currentPage = 1;
        const projectsPerPage = 9;
        const searchBox = document.getElementById('search-box');
        const grid = document.getElementById('portfolio-grid');
        const paginationContainer = document.getElementById('pagination-container');

        marked.setOptions({ gfm: true, breaks: true });

        function renderCards(proyectos) {
            grid.innerHTML = '';
            if (!proyectos || proyectos.length === 0) {
                grid.innerHTML = '<p class="empty-message">No se han encontrado proyectos.</p>';
                return;
            }

            const paginatedProjects = proyectos.slice().reverse().slice((currentPage - 1) * projectsPerPage, currentPage * projectsPerPage);

            paginatedProjects.forEach((proyecto, index) => {
                const card = document.createElement('a');
                card.className = 'card';
                card.href = `proyecto.html?id=${proyecto.id}`;
                
                card.addEventListener('mousemove', (e) => {
                    const rect = e.currentTarget.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = (y - centerY) / 15;
                    const rotateY = (centerX - x) / 15;
                    const innerCard = e.currentTarget.querySelector('.card-inner');
                    innerCard.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                });
                card.addEventListener('mouseleave', (e) => {
                    e.currentTarget.querySelector('.card-inner').style.transform = 'rotateX(0) rotateY(0) scale(1)';
                });

                card.innerHTML = `
                    <div class="card-inner">
                        <img class="card-hero-image" src="${proyecto.imagen}" alt="${proyecto.titulo}">
                        <div class="card-content">
                            <h2>${proyecto.titulo}</h2>
                            <div class="card-excerpt">${marked.parse(proyecto.resumen || '')}</div>
                            <span class="button-imitation">Ver detalles</span>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });
        }

        function setupPagination(totalProjects) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalProjects / projectsPerPage);
            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.innerText = i;
                pageButton.className = 'page-btn';
                if (i === currentPage) pageButton.classList.add('active');
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    filterAndRender();
                    const headerOffset = document.querySelector('header').offsetHeight;
                    window.scrollTo({ top: headerOffset, behavior: 'smooth' });
                });
                paginationContainer.appendChild(pageButton);
            }
        }

        function generateTags(proyectos) {
            const tagContainer = document.getElementById('tag-filter-container');
            const allTags = new Set();
            proyectos.forEach(p => (p.tags || []).forEach(tag => allTags.add(tag.trim())));
            
            tagContainer.innerHTML = '<button class="tag-button active" data-tag="all">Todos</button>';
            [...allTags].sort().forEach(tag => tagContainer.innerHTML += `<button class="tag-button" data-tag="${tag}">${tag}</button>`);

            document.querySelectorAll('.tag-button').forEach(button => {
                button.addEventListener('click', e => {
                    const clickedTag = e.target.dataset.tag;
                    if (clickedTag === 'all') activeTags.clear();
                    else activeTags.has(clickedTag) ? activeTags.delete(clickedTag) : activeTags.add(clickedTag);
                    
                    document.querySelectorAll('.tag-button').forEach(btn => {
                        btn.classList.toggle('active', (activeTags.size === 0 && btn.dataset.tag === 'all') || activeTags.has(btn.dataset.tag));
                    });
                    currentPage = 1;
                    filterAndRender();
                });
            });
        }

        function filterAndRender() {
            const searchTerm = searchBox.value.toLowerCase();
            let filtered = allProjects;

            if (searchTerm) filtered = filtered.filter(p => p.titulo.toLowerCase().includes(searchTerm));
            if (activeTags.size > 0) {
                filtered = filtered.filter(p => {
                    const projectTags = new Set((p.tags || []).map(t => t.trim()));
                    return [...activeTags].every(tag => projectTags.has(tag));
                });
            }
            renderCards(filtered);
            setupPagination(filtered.length);
        }

        fetch('proyectos.json').then(r=>r.json()).then(data=>{allProjects=data.items||[];window.proyectos=allProjects;generateTags(allProjects);filterAndRender()}).catch(e=>{grid.innerHTML='<p class="empty-message">Error al cargar proyectos.</p>'});
        searchBox.addEventListener('input', () => { currentPage = 1; filterAndRender(); });
        
        const gridBtn = document.getElementById('grid-view-btn');
        const listBtn = document.getElementById('list-view-btn');
        gridBtn.addEventListener('click', () => { grid.classList.remove('view-list'); gridBtn.classList.add('active'); listBtn.classList.remove('active'); });
        listBtn.addEventListener('click', () => { grid.classList.add('view-list'); listBtn.classList.add('active'); gridBtn.classList.remove('active'); });

        window.addEventListener('message', e => { if (e.data.type === 'previewUpdate') { allProjects = e.data.payload; generateTags(allProjects); filterAndRender(); } });
    </script>
    <script>
        (function() {
            const requiredLength = 5; let progress = 0;
            document.addEventListener('click', e => {
                const target = e.target;
                if (target.classList.contains('secret-letter') && parseInt(target.dataset.key) === progress) progress++;
                else if (!target.classList.contains('secret-letter')) progress = 0;
                if (progress === requiredLength) {
                    alert('Acceso correcto. Redirigiendo...');
                    window.location.href = 'panel.html';
                }
            });
        })();
    </script>
</body>
</html>
